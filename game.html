<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>贪吃蛇小游戏</title>
    <link rel="stylesheet" href="game.css"> <!-- 引入游戏的CSS文件 -->
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #282c34; /* 更加现代化的背景颜色 */
            color: #ffffff;
        }

        h1 {
            font-size: 36px;
            margin-bottom: 20px;
            color: #61dafb; /* 更醒目的标题颜色 */
        }

        #gameCanvas {
            background-color: #1c1c1c;
            border: 2px solid #444; /* 更加厚重的边框 */
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.5); /* 盒子阴影 */
        }

        .button-container {
            display: flex;
            justify-content: center;
            flex-wrap: wrap; /* 在手机端时，允许按钮换行 */
            margin-top: 20px;
        }

        .game-button {
            margin: 10px;
            padding: 10px 20px;
            background-color: #61dafb;
            color: #282c34;
            text-decoration: none;
            border-radius: 5px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .game-button:hover {
            background-color: #21a1f1; /* 悬停时更深的颜色 */
        }

        .score {
            font-size: 18px;
            margin-top: 20px;
            color: #ffffff;
        }

        /* 移动设备触控控制布局 */
        .controls {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
        }

        .control-row {
            display: flex;
            justify-content: center;
            margin: 5px 0;
        }

        .control-button {
            width: 60px;
            height: 60px;
            background-color: #61dafb;
            color: #282c34;
            font-size: 24px;
            border: none;
            border-radius: 50%;
            margin: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .control-button:hover {
            background-color: #21a1f1;
        }

        /* 响应式调整画布 */
        @media (max-width: 600px) {
            #gameCanvas {
                width: 300px;
                height: 300px;
            }
        }

    </style>
</head>
<body>
    <h1>贪吃蛇小游戏</h1>
    <canvas id="gameCanvas" width="400" height="400"></canvas>
    <div class="button-container">
        <button id="startButton" class="game-button">开始游戏</button>
        <button id="resetButton" class="game-button">复位</button>
        <a href="index.html" class="game-button">返回主页</a>
    </div>
    <div class="controls">
        <div class="control-row">
            <button id="up" class="control-button">↑</button>
        </div>
        <div class="control-row">
            <button id="left" class="control-button">←</button>
            <button id="down" class="control-button">↓</button>
            <button id="right" class="control-button">→</button>
        </div>
    </div>
    <div class="score">得分: <span id="score">0</span></div>

    <script>
        // 游戏变量
        let canvas = document.getElementById('gameCanvas');
        let ctx = canvas.getContext('2d');
        let box = 20;
        let snake = [];
        let score = 0;
        let speed = 200; // 调整速度，使游戏更慢
        let game;

        // 初始化蛇
        snake[0] = { x: 10 * box, y: 10 * box };

        let food = {
            x: Math.floor(Math.random() * 20) * box,
            y: Math.floor(Math.random() * 20) * box
        };

        let d; // 蛇的方向
        document.addEventListener('keydown', direction);

        // 方向控制
        function direction(event) {
            if (event.keyCode == 37 && d != 'RIGHT') {
                d = 'LEFT';
            } else if (event.keyCode == 38 && d != 'DOWN') {
                d = 'UP';
            } else if (event.keyCode == 39 && d != 'LEFT') {
                d = 'RIGHT';
            } else if (event.keyCode == 40 && d != 'UP') {
                d = 'DOWN';
            }
        }

        // 移动设备触控控制
        document.getElementById('up').addEventListener('click', function() {
            if (d != 'DOWN') d = 'UP';
        });

        document.getElementById('left').addEventListener('click', function() {
            if (d != 'RIGHT') d = 'LEFT';
        });

        document.getElementById('down').addEventListener('click', function() {
            if (d != 'UP') d = 'DOWN';
        });

        document.getElementById('right').addEventListener('click', function() {
            if (d != 'LEFT') d = 'RIGHT';
        });

        function collision(head, array) {
            // 检查是否与墙壁碰撞
            if (head.x < 0 || head.y < 0 || head.x >= canvas.width || head.y >= canvas.height) {
                return true;
            }
        
            // 检查是否与自身碰撞（保留原本的逻辑）
            for (let i = 0; i < array.length; i++) {
                if (head.x == array[i].x && head.y == array[i].y) {
                    return true;
                }
            }
        
            return false;
        }
        
        function draw() {
            ctx.fillStyle = '#1c1c1c'; // 背景颜色
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // 绘制蛇
            for (let i = 0; i < snake.length; i++) {
                ctx.fillStyle = (i == 0) ? '#61dafb' : '#28a745'; // 蛇头与蛇身颜色不同
                ctx.fillRect(snake[i].x, snake[i].y, box, box);
            }

            // 绘制食物
            ctx.fillStyle = '#e63946';
            ctx.fillRect(food.x, food.y, box, box);

            let snakeX = snake[0].x;
            let snakeY = snake[0].y;

            if (d == 'LEFT') snakeX -= box;
            if (d == 'UP') snakeY -= box;
            if (d == 'RIGHT') snakeX += box;
            if (d == 'DOWN') snakeY += box;

            // 检查蛇是否吃到食物
            if (snakeX == food.x && snakeY == food.y) {
                score++;
                document.getElementById('score').innerText = score;
                food = {
                    x: Math.floor(Math.random() * 20) * box,
                    y: Math.floor(Math.random() * 20) * box
                };
            } else {
                snake.pop();
            }

            let newHead = { x: snakeX, y: snakeY };

            // 检查游戏结束条件
            if (snakeX < 0 || snakeY < 0 || snakeX >= canvas.width|| snakeY >= canvas.height || collision(newHead, snake)) {
                clearInterval(game);
                alert('游戏结束! 您的得分: ' + score);
            }

            snake.unshift(newHead);
        }

        // 开始游戏按钮逻辑
        document.getElementById('startButton').addEventListener('click', function() {
            if (!game) { // 防止多次点击
                game = setInterval(draw, speed);
            }
        });

        // 复位按钮逻辑
        document.getElementById('resetButton').addEventListener('click', function() {
            clearInterval(game);
            game = null;
            score = 0;
            document.getElementById('score').innerText = score;
            snake = [{ x: 10 * box, y: 10 * box }];
            d = undefined;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            food = {
                x: Math.floor(Math.random() * 20) * box,
                y: Math.floor(Math.random() * 20) * box
            };
            draw();
        });

    </script>
</body>
</html>
